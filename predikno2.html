
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>prediksi NO2 &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'predikno2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="coba" href="coba.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/1000120759.webp" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/1000120759.webp" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    intro
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="myintro.html">my introdoction</a></li>
<li class="toctree-l1"><a class="reference internal" href="MemahamiBisnis.html">Memahami Bisnis</a></li>
<li class="toctree-l1"><a class="reference internal" href="DataUnderstanding.html">Data Understanding</a></li>
<li class="toctree-l1"><a class="reference internal" href="EksplorasiData.html">📊 Eksplorasi Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="iris_data.html">Analisis Clustering &amp; Anomaly Detection dengan PyCaret</a></li>
<li class="toctree-l1"><a class="reference internal" href="jjl.html">🚀 Deteksi Outlier dengan ABOD:</a></li>
<li class="toctree-l1"><a class="reference internal" href="adasyn.html">📊 Analisis dan Klasifikasi Dataset Iris dengan PCA, SMOTE, dan Logistic Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="coba.html">coba</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">prediksi NO2</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fpredikno2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/predikno2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>prediksi NO2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#penjelasan-kode-mengecek-atribut-metadata-koleksi-sentinel-5p">🛰️ Penjelasan Kode: Mengecek Atribut Metadata Koleksi Sentinel-5P</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan-utama">🔍 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penjelasan-baris-per-baris">💻 Penjelasan Baris per Baris</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#penjelasan-kode-mengambil-daftar-band-dari-metadata-sentinel-5p">🛰️ Penjelasan Kode: Mengambil Daftar Band dari Metadata Sentinel-5P</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">🔍 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">💻 Penjelasan Baris per Baris</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-1-mengambil-data-no2-dari-sentinel-5p-versi-final-yang-sudah-diperbaiki">🛰️ Tahap 1 – Mengambil Data NO₂ dari Sentinel-5P (Versi Final yang Sudah Diperbaiki)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-import-library">💻 1. Setup – Import Library</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-2-pra-pemrosesan-data-preprocessing-no2-sentinel-5p">🧹 Tahap 2 – Pra-Pemrosesan Data (Preprocessing NO₂ Sentinel-5P)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">🎯 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-library">💻 1. Import Library</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-3-feature-engineering-mengubah-data-time-series-menjadi-supervised">⚙️ Tahap 3 – Feature Engineering (Mengubah Data Time Series menjadi Supervised)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">🎯 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#konsep-singkat-lag-feature">💡 Konsep Singkat: “Lag Feature”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inisialisasi-dan-persiapan">💻 1. Inisialisasi dan Persiapan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tugas">Tugas:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#membuat-fitur-lag-data-1-2-3-hari-sebelumnya">1. Membuat “fitur lag” (data 1, 2, 3 hari sebelumnya).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mendefinisikan-x-fitur-dan-y-target">2. Mendefinisikan X (fitur) dan y (target).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#menghapus-baris-nan-yang-muncul-akibat-pergeseran">3. Menghapus baris NaN yang muncul akibat pergeseran.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penting-pastikan-anda-masih-punya-variabel-df">PENTING: Pastikan Anda masih punya variabel ‘df’</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dari-tahap-2-yang-sudah-bersih">dari Tahap 2 yang sudah bersih.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tentukan-jumlah-lag">1. TENTUKAN JUMLAH LAG</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sesuai-rencana-kita-akan-pakai-3-hari-sebelumnya-3-lags">Sesuai rencana, kita akan pakai 3 hari sebelumnya (3 lags)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#buat-dataframe-baru-untuk-data-supervised">Buat dataframe baru untuk data supervised</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#buat-fitur-lag">2. BUAT FITUR “LAG”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ini-adalah-inti-dari-sliding-window">Ini adalah inti dari “sliding window”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hapus-baris-kosong-nan">3. HAPUS BARIS KOSONG (NaN)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baris-baris-pertama-tidak-akan-punya-data-lag-jadi-kita-buang">Baris-baris pertama tidak akan punya data lag, jadi kita buang</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hasil-akhir">4. HASIL AKHIR</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-4-persiapan-model-normalisasi-train-test-split">⚙️ Tahap 4 – Persiapan Model (Normalisasi &amp; Train-Test Split)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan-tahap-4">🎯 Tujuan Tahap 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengapa-normalisasi-penting">💡 Mengapa Normalisasi Penting?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pisahkan-fitur-dan-target">💻 1. Pisahkan Fitur dan Target</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-5-pemodelan-knn-regression-evaluasi">🤖 Tahap 5 – Pemodelan (KNN Regression) &amp; Evaluasi</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan-tahap-5">🎯 Tujuan Tahap 5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sekilas-tentang-knn-regression">💡 Sekilas Tentang KNN Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#membuat-dan-melatih-model-knn">💻 1. Membuat dan Melatih Model KNN</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-5-lanjutan-menentukan-ambang-batas-threshold">⚖️ Langkah 5 (Lanjutan) – Menentukan Ambang Batas (Threshold)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan">🎯 Tujuan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kode-program">💻 Kode Program</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-5-lanjutan-2-menentukan-ambang-batas-baru-median-50">⚖️ Langkah 5 (Lanjutan 2) – Menentukan Ambang Batas Baru (Median / 50%)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">🎯 Tujuan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">💻 Kode Program</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-6-evaluasi-model-dalam-bentuk-klasifikasi-aman-vs-tidak-aman">🧭 Langkah 6 – Evaluasi Model dalam Bentuk Klasifikasi (Aman vs Tidak Aman)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">🎯 Tujuan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-7-membuat-prediksi-2-hari-ke-depan">🔮 Langkah 7 – Membuat Prediksi 2 Hari ke Depan</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">🎯 Tujuan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">💻 Kode Program</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-eksperimen-mencari-jumlah-lag-fitur-terbaik">🧪 Langkah Eksperimen – Mencari Jumlah Lag (Fitur) Terbaik</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">🎯 Tujuan</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="prediksi-no2">
<h1>prediksi NO2<a class="headerlink" href="#prediksi-no2" title="Link to this heading">#</a></h1>
<section id="penjelasan-kode-mengecek-atribut-metadata-koleksi-sentinel-5p">
<h2>🛰️ Penjelasan Kode: Mengecek Atribut Metadata Koleksi Sentinel-5P<a class="headerlink" href="#penjelasan-kode-mengecek-atribut-metadata-koleksi-sentinel-5p" title="Link to this heading">#</a></h2>
<p>Kode berikut digunakan untuk <strong>mengeksplorasi atribut dan method</strong> dari objek <code class="docutils literal notranslate"><span class="pre">CollectionMetadata</span></code> yang diambil dari sebuah koleksi data satelit (contohnya <strong>SENTINEL_5P_L2</strong>).<br />
Tujuannya adalah untuk melihat <strong>struktur internal objek metadata</strong> — agar kita tahu properti apa saja yang bisa digunakan dalam analisis.</p>
<hr class="docutils" />
<section id="tujuan-utama">
<h3>🔍 Tujuan Utama<a class="headerlink" href="#tujuan-utama" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Mengambil metadata lengkap dari koleksi tertentu (<code class="docutils literal notranslate"><span class="pre">SENTINEL_5P_L2</span></code>).</p></li>
<li><p>Menampilkan semua atribut dan method dalam objek metadata.</p></li>
<li><p>Membantu memahami isi dan struktur data sebelum digunakan lebih lanjut.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="penjelasan-baris-per-baris">
<h3>💻 Penjelasan Baris per Baris<a class="headerlink" href="#penjelasan-baris-per-baris" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kita akan pakai print(dir(...)) untuk melihat semua </span>
<span class="c1"># atribut yang dimiliki objek &#39;full_meta&#39;.</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kita akan pakai print(dir(...)) untuk melihat semua </span>
<span class="c1"># atribut yang dimiliki objek &#39;full_meta&#39;.</span>

<span class="c1"># ID Koleksi yang kita temukan</span>
<span class="n">collection_id_terpilih</span> <span class="o">=</span> <span class="s2">&quot;SENTINEL_5P_L2&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Menginspeksi objek &#39;CollectionMetadata&#39; untuk: </span><span class="si">{</span><span class="n">collection_id_terpilih</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mencari semua atribut dan method yang tersedia...&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># (Pastikan variabel &#39;connection&#39; Anda masih aktif)</span>
    
    <span class="c1"># Ambil metadata lengkap (ini adalah objek &#39;CollectionMetadata&#39;)</span>
    <span class="n">full_meta</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">collection_metadata</span><span class="p">(</span><span class="n">collection_id_terpilih</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Berhasil mengambil objek &#39;full_meta&#39;.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mencetak semua atribut yang tersedia (menggunakan dir()):</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Perintah KUNCI: Tampilkan semua yang ada di dalam objek &#39;full_meta&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">full_meta</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selesai.&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- GAGAL ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gagal saat mencoba mengambil metadata: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Menginspeksi objek &#39;CollectionMetadata&#39; untuk: SENTINEL_5P_L2
Mencari semua atribut dan method yang tersedia...
--------------------------------------------------

--- GAGAL ---
Gagal saat mencoba mengambil metadata: name &#39;connection&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="penjelasan-kode-mengambil-daftar-band-dari-metadata-sentinel-5p">
<h2>🛰️ Penjelasan Kode: Mengambil Daftar Band dari Metadata Sentinel-5P<a class="headerlink" href="#penjelasan-kode-mengambil-daftar-band-dari-metadata-sentinel-5p" title="Link to this heading">#</a></h2>
<p>Kode berikut digunakan untuk <strong>mengambil dan menampilkan daftar nama band (band_names)</strong> dari metadata koleksi <code class="docutils literal notranslate"><span class="pre">SENTINEL_5P_L2</span></code>.<br />
Band (atau kanal spektral) adalah variabel-variabel pengamatan satelit, seperti <strong>NO₂</strong>, <strong>O₃</strong>, <strong>CO</strong>, <strong>CH₄</strong>, dan lain-lain.</p>
<hr class="docutils" />
<section id="id1">
<h3>🔍 Tujuan Utama<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Mengakses atribut <code class="docutils literal notranslate"><span class="pre">band_names</span></code> dari objek metadata koleksi.</p></li>
<li><p>Menampilkan semua nama band yang tersedia secara rapi.</p></li>
<li><p>Jika atribut <code class="docutils literal notranslate"><span class="pre">band_names</span></code> tidak ditemukan, mencoba alternatif atribut <code class="docutils literal notranslate"><span class="pre">bands</span></code>.</p></li>
<li><p>Menyiapkan data awal untuk memilih band tertentu (misalnya band <strong>NO₂</strong>).</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="id2">
<h3>💻 Penjelasan Baris per Baris<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Berdasarkan output &#39;dir()&#39;, kita menemukan atribut &#39;band_names&#39;.</span>
<span class="c1"># Mari kita panggil atribut itu.</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Berdasarkan output &#39;dir()&#39;, kita menemukan atribut &#39;band_names&#39;.</span>
<span class="c1"># Mari kita panggil atribut itu.</span>

<span class="c1"># ID Koleksi yang kita temukan</span>
<span class="n">collection_id_terpilih</span> <span class="o">=</span> <span class="s2">&quot;SENTINEL_5P_L2&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mengambil &#39;band_names&#39; dari metadata: </span><span class="si">{</span><span class="n">collection_id_terpilih</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;--------------------------------------------------&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># (Pastikan variabel &#39;connection&#39; Anda masih aktif)</span>
    
    <span class="c1"># Ambil metadata lengkap (ini adalah objek &#39;CollectionMetadata&#39;)</span>
    <span class="n">full_meta</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">collection_metadata</span><span class="p">(</span><span class="n">collection_id_terpilih</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Berhasil mengambil objek &#39;full_meta&#39;.&quot;</span><span class="p">)</span>
    
    <span class="c1"># KUNCI UTAMA: Coba akses atribut .band_names</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">full_meta</span><span class="p">,</span> <span class="s1">&#39;band_names&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- DITEMUKAN atribut &#39;band_names&#39; ---&quot;</span><span class="p">)</span>
        <span class="n">nama_band</span> <span class="o">=</span> <span class="n">full_meta</span><span class="o">.</span><span class="n">band_names</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">nama_band</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Atribut &#39;band_names&#39; ada tapi KOSONG.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Daftar semua nama band:&quot;</span><span class="p">)</span>
            <span class="c1"># Cetak satu per satu agar rapi</span>
            <span class="k">for</span> <span class="n">nama</span> <span class="ow">in</span> <span class="n">nama_band</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">nama</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Aneh, &#39;band_names&#39; ada di &#39;dir()&#39; tapi tidak &#39;hasattr()&#39;.&quot;</span><span class="p">)</span>

    <span class="c1"># JAGA-JAGA: Coba juga .bands</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">full_meta</span><span class="p">,</span> <span class="s1">&#39;bands&#39;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- DITEMUKAN atribut &#39;bands&#39; ---&quot;</span><span class="p">)</span>
        <span class="n">info_bands</span> <span class="o">=</span> <span class="n">full_meta</span><span class="o">.</span><span class="n">bands</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Isi dari &#39;bands&#39;:&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">info_bands</span><span class="p">)</span> <span class="c1"># Cetak apa adanya</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--------------------------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Selesai.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Cari nama band NO2 dari output di atas.&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- GAGAL ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gagal saat mencoba mengambil &#39;band_names&#39;: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mengambil &#39;band_names&#39; dari metadata: SENTINEL_5P_L2
--------------------------------------------------

--- GAGAL ---
Gagal saat mencoba mengambil &#39;band_names&#39;: name &#39;connection&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="tahap-1-mengambil-data-no2-dari-sentinel-5p-versi-final-yang-sudah-diperbaiki">
<h2>🛰️ Tahap 1 – Mengambil Data NO₂ dari Sentinel-5P (Versi Final yang Sudah Diperbaiki)<a class="headerlink" href="#tahap-1-mengambil-data-no2-dari-sentinel-5p-versi-final-yang-sudah-diperbaiki" title="Link to this heading">#</a></h2>
<p>Kode ini adalah tahap pertama dari alur kerja pengambilan data <strong>NO₂</strong> menggunakan <strong>Sentinel-5P Level-2</strong> melalui layanan <strong>OpenEO Copernicus Data Space</strong>.<br />
Tujuan utamanya adalah untuk:</p>
<ol class="arabic simple">
<li><p>Menghubungkan ke server Copernicus Data Space.</p></li>
<li><p>Menentukan area dan rentang waktu analisis.</p></li>
<li><p>Membuat <em>data cube</em> (resep pemrosesan) untuk menghitung rata-rata NO₂ harian dan spasial.</p></li>
<li><p>Menjalankan <em>job</em> untuk mengunduh hasilnya dalam bentuk CSV.</p></li>
<li><p>Memverifikasi isi file hasil unduhan.</p></li>
</ol>
<hr class="docutils" />
<section id="setup-import-library">
<h3>💻 1. Setup – Import Library<a class="headerlink" href="#setup-import-library" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">openeo</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Library berhasil di-impor.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kita sekarang menggunakan ID Koleksi: SENTINEL_5P_L2</span>
<span class="c1"># dan Nama Band: NO2</span>
<span class="c1">#</span>

<span class="c1"># 1. SETUP: Impor library yang dibutuhkan</span>
<span class="kn">import</span> <span class="nn">openeo</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Library berhasil di-impor.&quot;</span><span class="p">)</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># 2. KONEKSI: Hubungkan ke server Copernicus</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menghubungkan ke server openeo.dataspace.copernicus.eu...&quot;</span><span class="p">)</span>

<span class="c1"># Anda mungkin tidak perlu autentikasi lagi jika sesi masih aktif</span>
<span class="c1"># Tapi jika error, jalankan baris di bawah ini:</span>
<span class="c1"># connection.authenticate_oidc() </span>

<span class="c1"># Baris ini mengasumsikan variabel &#39;connection&#39; Anda masih ada</span>
<span class="c1"># Jika Anda me-restart kernel, Anda harus jalankan lagi:</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">connection</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Koneksi &#39;connection&#39; sudah ada. Melanjutkan...&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Membuat koneksi &#39;connection&#39; baru...&quot;</span><span class="p">)</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">openeo</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;openeo.dataspace.copernicus.eu&quot;</span><span class="p">)</span>
    <span class="n">connection</span><span class="o">.</span><span class="n">authenticate_oidc</span><span class="p">()</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Berhasil terhubung!&quot;</span><span class="p">)</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># 3. TENTUKAN PARAMETER ANDA</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menyiapkan parameter...&quot;</span><span class="p">)</span>

<span class="c1"># A. Parameter Waktu (Temporal Extent)</span>
<span class="n">temporal_extent</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2021-01-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-12-31&quot;</span><span class="p">]</span>

<span class="c1"># B. Parameter Lokasi (Spatial Extent) - GeoJSON Anda</span>
<span class="n">geojson_polygon_anda</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;coordinates&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="p">[</span><span class="mf">111.78029945930473</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.083952654390501</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">111.78029945930473</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.189061951686597</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">111.91071379866247</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.189061951686597</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">111.91071379866247</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.083952654390501</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">111.78029945930473</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.083952654390501</span><span class="p">]</span>
      <span class="p">]</span>
    <span class="p">],</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Polygon&quot;</span>
<span class="p">}</span>

<span class="c1"># C. Parameter Data (Data Collection) - INI YANG KITA PERBAIKI</span>
<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;SENTINEL_5P_L2&quot;</span>   <span class="c1"># &lt;&lt;&lt; PERUBAHAN DI SINI</span>
<span class="n">band_name</span> <span class="o">=</span> <span class="s2">&quot;NO2&quot;</span>                  <span class="c1"># &lt;&lt;&lt; PERUBAHAN DI SINI</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Parameter diatur: Area Anda, Waktu </span><span class="si">{</span><span class="n">temporal_extent</span><span class="si">}</span><span class="s2">, Data </span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2">, Band </span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># 4. PROSES PENGAMBILAN DATA (MEMBUAT &#39;RESEP&#39;)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Membangun &#39;data cube&#39; (resep proses)...&quot;</span><span class="p">)</span>

<span class="c1"># 1. Muat koleksi data awal</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">temporal_extent</span><span class="o">=</span><span class="n">temporal_extent</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="n">band_name</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># 2. Agregasi Temporal (Menjadi Rata-rata Harian)</span>
<span class="c1"># ... (komentar) ...</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Menambahkan langkah: aggregate_temporal_period (rata-rata harian)&quot;</span><span class="p">)</span>
<span class="n">cube_daily</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">aggregate_temporal_period</span><span class="p">(</span>
    <span class="n">period</span><span class="o">=</span><span class="s2">&quot;day&quot;</span><span class="p">,</span>   <span class="c1"># &lt;&lt;&lt; UBAH &#39;interval&#39; MENJADI &#39;period&#39;</span>
    <span class="n">reducer</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>  <span class="c1"># &#39;mean&#39; artinya ambil rata-rata</span>
<span class="p">)</span>

<span class="c1"># 3. Agregasi Spasial (Menjadi Rata-rata Area Poligon)</span>
<span class="c1"># Sekarang dari data harian itu, kita ambil rata-rata </span>
<span class="c1"># semua pixel di dalam poligon kita.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Menambahkan langkah: aggregate_spatial (rata-rata di dalam poligon)&quot;</span><span class="p">)</span>
<span class="n">cube_aggregated</span> <span class="o">=</span> <span class="n">cube_daily</span><span class="o">.</span><span class="n">aggregate_spatial</span><span class="p">(</span>
    <span class="n">geometries</span><span class="o">=</span><span class="n">geojson_polygon_anda</span><span class="p">,</span>
    <span class="n">reducer</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>  <span class="c1"># &#39;mean&#39; artinya ambil rata-rata</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&#39;Data cube&#39; (resep) berhasil dibuat.&quot;</span><span class="p">)</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># 5. EKSEKUSI DAN UNDUH HASIL</span>
<span class="n">output_file</span> <span class="o">=</span> <span class="s2">&quot;no2_data_area_anda.csv&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Memulai &#39;job&#39; untuk mengambil data. &quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;CATATAN: Karena kita memproses data L2 (mentah), &#39;job&#39; ini&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mungkin butuh waktu 5-15 menit. Mohon ditunggu...&quot;</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Perintah untuk menjalankan &#39;resep&#39; dan mengunduh hasilnya</span>
    <span class="n">cube_aggregated</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;CSV&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- BERHASIL! ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data telah diunduh ke file: </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- GAGAL ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Terjadi error saat &#39;job&#39; dieksekusi: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Silakan cek pesan error di atas.&quot;</span><span class="p">)</span>

<span class="c1"># -------------------------------------------------------------------</span>
<span class="c1"># 6. VERIFIKASI (Opsional tapi sangat disarankan)</span>
<span class="c1"># Mari kita baca file CSV yang baru saja diunduh untuk melihat isinya</span>

<span class="k">try</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Membaca file </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> untuk verifikasi...&quot;</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">output_file</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pratinjau Data (5 baris pertama):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Info Data:&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Jumlah baris data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Tahap 1 Selesai. File CSV Anda sudah siap untuk tahap 2 (Preprocessing).&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verifikasi gagal: File </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2"> tidak ditemukan.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Verifikasi gagal: Error saat membaca CSV: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Kita sekarang menggunakan ID Koleksi: SENTINEL_5P_L2</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="c1"># dan Nama Band: NO2</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">#</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> 
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="c1"># 1. SETUP: Impor library yang dibutuhkan</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="kn">import</span> <span class="nn">openeo</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="kn">import</span> <span class="nn">json</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;openeo&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="tahap-2-pra-pemrosesan-data-preprocessing-no2-sentinel-5p">
<h2>🧹 Tahap 2 – Pra-Pemrosesan Data (Preprocessing NO₂ Sentinel-5P)<a class="headerlink" href="#tahap-2-pra-pemrosesan-data-preprocessing-no2-sentinel-5p" title="Link to this heading">#</a></h2>
<p>Setelah data <strong>NO₂</strong> berhasil diunduh dalam format CSV pada Tahap 1, tahap ini bertujuan untuk <strong>membersihkan, mengurutkan, mengisi nilai hilang, dan memvisualisasikan tren data waktu (time series)</strong>.</p>
<hr class="docutils" />
<section id="id3">
<h3>🎯 Tujuan Utama<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Membaca ulang data hasil unduhan (<code class="docutils literal notranslate"><span class="pre">no2_data_area_anda.csv</span></code>).</p></li>
<li><p>Membersihkan data (hapus kolom tidak perlu, ubah format tanggal).</p></li>
<li><p>Mengurutkan data berdasarkan tanggal.</p></li>
<li><p>Mengisi nilai hilang (<code class="docutils literal notranslate"><span class="pre">NaN</span></code>) menggunakan <strong>interpolasi linear</strong>.</p></li>
<li><p>Melakukan <strong>visualisasi tren polusi NO₂</strong> setelah data bersih.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="import-library">
<h3>💻 1. Import Library<a class="headerlink" href="#import-library" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tugas:</span>
<span class="c1"># 1. Membaca ulang data.</span>
<span class="c1"># 2. Membersihkan dan mengurutkan data berdasarkan tanggal.</span>
<span class="c1"># 3. Mengisi &#39;missing values&#39; (NaN) menggunakan interpolasi.</span>
<span class="c1">#</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memulai Tahap 2: Pra-Pemrosesan Data...&quot;</span><span class="p">)</span>

<span class="c1"># 1. MUAT DATA</span>
<span class="n">file_csv</span> <span class="o">=</span> <span class="s2">&quot;no2_data_area_anda.csv&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_csv</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Berhasil memuat </span><span class="si">{</span><span class="n">file_csv</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: File </span><span class="si">{</span><span class="n">file_csv</span><span class="si">}</span><span class="s2"> tidak ditemukan!&quot;</span><span class="p">)</span>
    <span class="c1"># Hentikan eksekusi jika file tidak ada</span>

<span class="c1"># 2. BERSIHKAN &amp; ATUR INDEKS</span>
<span class="k">if</span> <span class="s1">&#39;df&#39;</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
    <span class="c1"># Buang kolom yang tidak perlu</span>
    <span class="k">if</span> <span class="s1">&#39;feature_index&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;feature_index&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Kolom &#39;feature_index&#39; dibuang.&quot;</span><span class="p">)</span>
        
    <span class="c1"># Ubah &#39;date&#39; menjadi format datetime</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Kolom &#39;date&#39; diubah ke format datetime.&quot;</span><span class="p">)</span>
    
    <span class="c1"># PENTING: Urutkan berdasarkan tanggal!</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Data diurutkan berdasarkan tanggal (ascending).&quot;</span><span class="p">)</span>
    
    <span class="c1"># Jadikan &#39;date&#39; sebagai index</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Kolom &#39;date&#39; dijadikan sebagai indeks.&quot;</span><span class="p">)</span>

    <span class="c1"># Ganti nama kolom &#39;NO2&#39; biar lebih jelas (opsional)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;NO2&#39;</span><span class="p">:</span> <span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Kolom &#39;NO2&#39; diganti nama menjadi &#39;rata_rata_no2&#39;.&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data SEBELUM Interpolasi:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pratinjau Data (head):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Info Data (mengecek missing values):&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
    
    <span class="c1"># 3. TANGANI MISSING VALUES (INTERPOLASI)</span>
    <span class="c1"># Ini adalah inti dari Tahap 2</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Melakukan interpolasi linear untuk mengisi NaN...&quot;</span><span class="p">)</span>
    
    <span class="c1"># &#39;method=&#39;linear&#39;&#39; akan menarik garis lurus</span>
    <span class="c1"># antara data yang ada untuk mengisi kekosongan.</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Interpolasi selesai.&quot;</span><span class="p">)</span>

    <span class="c1"># 4. VERIFIKASI AKHIR</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data SETELAH Interpolasi:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;---------------------------------&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Info Data (mengecek apakah NaN sudah hilang):&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="c1"># Seharusnya &#39;rata_rata_no2&#39; sekarang 1095 non-null</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Pratinjau Data (head) setelah interpolasi:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span> <span class="c1"># Data NaN di awal mungkin masih ada jika data pertama adalah NaN</span>

    <span class="c1"># PENTING: Interpolasi linear tidak bisa mengisi data di AWAL</span>
    <span class="c1"># atau AKHIR jika datanya NaN. Kita isi manual pakai &#39;bfill&#39; (backward fill)</span>
    <span class="c1"># dan &#39;ffill&#39; (forward fill)</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Menangani sisa NaN di awal/akhir data...&quot;</span><span class="p">)</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span> <span class="c1"># Isi NaN di awal</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span> <span class="c1"># Isi NaN di akhir (jaga-jaga)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;  - Sisa NaN berhasil diisi.&quot;</span><span class="p">)</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Info Data FINAL:&quot;</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="c1"># SEKARANG PASTI 1095 non-null</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tahap 2 Selesai. Data Anda sekarang bersih, terurut,&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dan tidak ada nilai yang hilang (missing).&quot;</span><span class="p">)</span>
    
    <span class="c1"># 5. VISUALISASI HASIL (Sangat disarankan)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Membuat plot visualisasi data time series...&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;rata_rata_no2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Tren Polusi NO2 (2021-2023) - Setelah Interpolasi&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Rata-rata NO2&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tanggal&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Memulai Tahap 2: Pra-Pemrosesan Data...
Berhasil memuat no2_data_area_anda.csv.
  - Kolom &#39;feature_index&#39; dibuang.
  - Kolom &#39;date&#39; diubah ke format datetime.
  - Data diurutkan berdasarkan tanggal (ascending).
  - Kolom &#39;date&#39; dijadikan sebagai indeks.
  - Kolom &#39;NO2&#39; diganti nama menjadi &#39;rata_rata_no2&#39;.

Data SEBELUM Interpolasi:
---------------------------------
Pratinjau Data (head):
                           rata_rata_no2
date                                    
2020-12-31 00:00:00+00:00            NaN
2021-01-01 00:00:00+00:00            NaN
2021-01-02 00:00:00+00:00            NaN
2021-01-03 00:00:00+00:00            NaN
2021-01-04 00:00:00+00:00        0.00002

Info Data (mengecek missing values):
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 1095 entries, 2020-12-31 00:00:00+00:00 to 2023-12-30 00:00:00+00:00
Data columns (total 1 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   rata_rata_no2  619 non-null    float64
dtypes: float64(1)
memory usage: 17.1 KB

Melakukan interpolasi linear untuk mengisi NaN...
  - Interpolasi selesai.

Data SETELAH Interpolasi:
---------------------------------
Info Data (mengecek apakah NaN sudah hilang):
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 1095 entries, 2020-12-31 00:00:00+00:00 to 2023-12-30 00:00:00+00:00
Data columns (total 1 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   rata_rata_no2  1091 non-null   float64
dtypes: float64(1)
memory usage: 17.1 KB

Pratinjau Data (head) setelah interpolasi:
                           rata_rata_no2
date                                    
2020-12-31 00:00:00+00:00            NaN
2021-01-01 00:00:00+00:00            NaN
2021-01-02 00:00:00+00:00            NaN
2021-01-03 00:00:00+00:00            NaN
2021-01-04 00:00:00+00:00        0.00002

Menangani sisa NaN di awal/akhir data...
  - Sisa NaN berhasil diisi.

Info Data FINAL:
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
DatetimeIndex: 1095 entries, 2020-12-31 00:00:00+00:00 to 2023-12-30 00:00:00+00:00
Data columns (total 1 columns):
 #   Column         Non-Null Count  Dtype  
---  ------         --------------  -----  
 0   rata_rata_no2  1095 non-null   float64
dtypes: float64(1)
memory usage: 17.1 KB

Tahap 2 Selesai. Data Anda sekarang bersih, terurut,
dan tidak ada nilai yang hilang (missing).

Membuat plot visualisasi data time series...
</pre></div>
</div>
<img alt="_images/a789bb4364845dd1c57c3dc23a56846332bdaf69395e074d76b570f97a7cb4be.png" src="_images/a789bb4364845dd1c57c3dc23a56846332bdaf69395e074d76b570f97a7cb4be.png" />
</div>
</div>
</section>
</section>
<section id="tahap-3-feature-engineering-mengubah-data-time-series-menjadi-supervised">
<h2>⚙️ Tahap 3 – Feature Engineering (Mengubah Data Time Series menjadi Supervised)<a class="headerlink" href="#tahap-3-feature-engineering-mengubah-data-time-series-menjadi-supervised" title="Link to this heading">#</a></h2>
<p>Pada tahap ini, data deret waktu (<strong>time series</strong>) NO₂ akan diubah menjadi format <strong>supervised learning</strong>, yaitu bentuk data yang bisa digunakan oleh model machine learning (misalnya regresi, LSTM, atau Random Forest).</p>
<hr class="docutils" />
<section id="id4">
<h3>🎯 Tujuan Utama<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Membuat <strong>fitur lag</strong> — yaitu data dari beberapa hari sebelumnya.</p></li>
<li><p>Mendefinisikan variabel <strong>fitur (X)</strong> dan <strong>target (y)</strong>.</p></li>
<li><p>Menghapus baris kosong (NaN) yang muncul akibat pergeseran data.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="konsep-singkat-lag-feature">
<h3>💡 Konsep Singkat: “Lag Feature”<a class="headerlink" href="#konsep-singkat-lag-feature" title="Link to this heading">#</a></h3>
<p>Dalam analisis deret waktu, nilai masa lalu sering memengaruhi nilai saat ini.<br />
Misalnya, kadar NO₂ hari ini bisa dipengaruhi oleh kadar NO₂ dari 1–3 hari sebelumnya.</p>
<p>Oleh karena itu, kita buat kolom tambahan:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">lag_1_hari</span></code> → nilai NO₂ kemarin</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lag_2_hari</span></code> → nilai NO₂ dua hari lalu</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">lag_3_hari</span></code> → nilai NO₂ tiga hari lalu</p></li>
</ul>
<p>Dengan demikian, model machine learning bisa belajar pola berdasarkan tren historis.</p>
</section>
<hr class="docutils" />
<section id="inisialisasi-dan-persiapan">
<h3>💻 1. Inisialisasi dan Persiapan<a class="headerlink" href="#inisialisasi-dan-persiapan" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memulai Tahap 3: Feature Engineering...&quot;</span><span class="p">)</span>

<span class="n">n_lags</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">nama_target</span> <span class="o">=</span> <span class="s1">&#39;rata_rata_no2&#39;</span>

<span class="n">df_supervised</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>
<section id="tugas">
<h2>Tugas:<a class="headerlink" href="#tugas" title="Link to this heading">#</a></h2>
<section id="membuat-fitur-lag-data-1-2-3-hari-sebelumnya">
<h3>1. Membuat “fitur lag” (data 1, 2, 3 hari sebelumnya).<a class="headerlink" href="#membuat-fitur-lag-data-1-2-3-hari-sebelumnya" title="Link to this heading">#</a></h3>
</section>
<section id="mendefinisikan-x-fitur-dan-y-target">
<h3>2. Mendefinisikan X (fitur) dan y (target).<a class="headerlink" href="#mendefinisikan-x-fitur-dan-y-target" title="Link to this heading">#</a></h3>
</section>
<section id="menghapus-baris-nan-yang-muncul-akibat-pergeseran">
<h3>3. Menghapus baris NaN yang muncul akibat pergeseran.<a class="headerlink" href="#menghapus-baris-nan-yang-muncul-akibat-pergeseran" title="Link to this heading">#</a></h3>
<p>print(“Memulai Tahap 3: Feature Engineering…”)</p>
</section>
<section id="penting-pastikan-anda-masih-punya-variabel-df">
<h3>PENTING: Pastikan Anda masih punya variabel ‘df’<a class="headerlink" href="#penting-pastikan-anda-masih-punya-variabel-df" title="Link to this heading">#</a></h3>
</section>
<section id="dari-tahap-2-yang-sudah-bersih">
<h3>dari Tahap 2 yang sudah bersih.<a class="headerlink" href="#dari-tahap-2-yang-sudah-bersih" title="Link to this heading">#</a></h3>
</section>
<section id="tentukan-jumlah-lag">
<h3>1. TENTUKAN JUMLAH LAG<a class="headerlink" href="#tentukan-jumlah-lag" title="Link to this heading">#</a></h3>
</section>
<section id="sesuai-rencana-kita-akan-pakai-3-hari-sebelumnya-3-lags">
<h3>Sesuai rencana, kita akan pakai 3 hari sebelumnya (3 lags)<a class="headerlink" href="#sesuai-rencana-kita-akan-pakai-3-hari-sebelumnya-3-lags" title="Link to this heading">#</a></h3>
<p>n_lags = 3
nama_target = ‘rata_rata_no2’</p>
</section>
<section id="buat-dataframe-baru-untuk-data-supervised">
<h3>Buat dataframe baru untuk data supervised<a class="headerlink" href="#buat-dataframe-baru-untuk-data-supervised" title="Link to this heading">#</a></h3>
<p>df_supervised = df.copy()</p>
</section>
<section id="buat-fitur-lag">
<h3>2. BUAT FITUR “LAG”<a class="headerlink" href="#buat-fitur-lag" title="Link to this heading">#</a></h3>
</section>
<section id="ini-adalah-inti-dari-sliding-window">
<h3>Ini adalah inti dari “sliding window”<a class="headerlink" href="#ini-adalah-inti-dari-sliding-window" title="Link to this heading">#</a></h3>
<p>for i in range(1, n_lags + 1):
nama_kolom_lag = f’lag_{i}_hari’
df_supervised[nama_kolom_lag] = df_supervised[nama_target].shift(i)
print(f”  - Fitur ‘{nama_kolom_lag}’ dibuat.”)</p>
</section>
<section id="hapus-baris-kosong-nan">
<h3>3. HAPUS BARIS KOSONG (NaN)<a class="headerlink" href="#hapus-baris-kosong-nan" title="Link to this heading">#</a></h3>
</section>
<section id="baris-baris-pertama-tidak-akan-punya-data-lag-jadi-kita-buang">
<h3>Baris-baris pertama tidak akan punya data lag, jadi kita buang<a class="headerlink" href="#baris-baris-pertama-tidak-akan-punya-data-lag-jadi-kita-buang" title="Link to this heading">#</a></h3>
<p>print(“\nBentuk data SEBELUM .dropna():”, df_supervised.shape)
print(“Pratinjau data dengan NaN (head):”)
print(df_supervised.head())</p>
<p>df_supervised = df_supervised.dropna()</p>
<p>print(“\nBentuk data SETELAH .dropna():”, df_supervised.shape)
print(f”  - {n_lags} baris pertama yang mengandung NaN dibuang.”)</p>
</section>
<section id="hasil-akhir">
<h3>4. HASIL AKHIR<a class="headerlink" href="#hasil-akhir" title="Link to this heading">#</a></h3>
<p>print(“\n— HASIL TAHAP 3: DATA SUPERVISED —“)
print(“Pratinjau data (head) yang siap untuk model ML:”)
print(df_supervised.head())</p>
<p>print(“\nKolom target (y) kita adalah: ‘rata_rata_no2’”)
print(“Kolom fitur (X) kita adalah: ‘lag_1_hari’, ‘lag_2_hari’, ‘lag_3_hari’”)
print(“\nTahap 3 Selesai. Data sudah berhasil diubah”)
print(“dari Time Series murni menjadi format Supervised Learning.”)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>scikit-learn
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting scikit-learn
  Downloading scikit_learn-1.7.2-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.whl.metadata (11 kB)
Requirement already satisfied: numpy&gt;=1.22.0 in /opt/conda/envs/openeo/lib/python3.11/site-packages (from scikit-learn) (1.26.4)
Requirement already satisfied: scipy&gt;=1.8.0 in /opt/conda/envs/openeo/lib/python3.11/site-packages (from scikit-learn) (1.13.1)
Collecting joblib&gt;=1.2.0 (from scikit-learn)
  Downloading joblib-1.5.2-py3-none-any.whl.metadata (5.6 kB)
Collecting threadpoolctl&gt;=3.1.0 (from scikit-learn)
  Downloading threadpoolctl-3.6.0-py3-none-any.whl.metadata (13 kB)
Downloading scikit_learn-1.7.2-cp311-cp311-manylinux2014_x86_64.manylinux_2_17_x86_64.whl (9.7 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">9.7/9.7 MB</span> <span class=" -Color -Color-Red">10.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>00:0100:01
?25hDownloading joblib-1.5.2-py3-none-any.whl (308 kB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">308.4/308.4 kB</span> <span class=" -Color -Color-Red">4.0 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>:00:01
?25hDownloading threadpoolctl-3.6.0-py3-none-any.whl (18 kB)
Installing collected packages: threadpoolctl, joblib, scikit-learn
Successfully installed joblib-1.5.2 scikit-learn-1.7.2 threadpoolctl-3.6.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="tahap-4-persiapan-model-normalisasi-train-test-split">
<h2>⚙️ Tahap 4 – Persiapan Model (Normalisasi &amp; Train-Test Split)<a class="headerlink" href="#tahap-4-persiapan-model-normalisasi-train-test-split" title="Link to this heading">#</a></h2>
<p>Setelah data diubah menjadi format <strong>supervised learning</strong> pada Tahap 3, sekarang kita akan mempersiapkannya agar siap untuk dilatih oleh model machine learning.</p>
<hr class="docutils" />
<section id="tujuan-tahap-4">
<h3>🎯 Tujuan Tahap 4<a class="headerlink" href="#tujuan-tahap-4" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Memisahkan data menjadi:</p>
<ul class="simple">
<li><p><strong>X</strong> → fitur (lag)</p></li>
<li><p><strong>y</strong> → target (nilai NO₂ hari ini)</p></li>
</ul>
</li>
<li><p>Melakukan <strong>normalisasi (scaling)</strong> agar skala tiap fitur seragam.</p></li>
<li><p>Membagi dataset menjadi <strong>data latih (train)</strong> dan <strong>data uji (test)</strong>.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="mengapa-normalisasi-penting">
<h3>💡 Mengapa Normalisasi Penting?<a class="headerlink" href="#mengapa-normalisasi-penting" title="Link to this heading">#</a></h3>
<p>Fitur “lag” bisa memiliki rentang nilai yang berbeda.<br />
Tanpa normalisasi, model seperti KNN, SVM, atau neural network bisa bias terhadap fitur dengan skala lebih besar.</p>
<p>👉 Karena itu, kita gunakan <strong>MinMaxScaler</strong> untuk menyesuaikan semua fitur ke rentang <strong>[0, 1]</strong>.</p>
</section>
<hr class="docutils" />
<section id="pisahkan-fitur-dan-target">
<h3>💻 1. Pisahkan Fitur dan Target<a class="headerlink" href="#pisahkan-fitur-dan-target" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memulai Tahap 4: Persiapan Model...&quot;</span><span class="p">)</span>

<span class="n">fitur_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lag_1_hari&#39;</span><span class="p">,</span> <span class="s1">&#39;lag_2_hari&#39;</span><span class="p">,</span> <span class="s1">&#39;lag_3_hari&#39;</span><span class="p">]</span>
<span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;rata_rata_no2&#39;</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">fitur_cols</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bentuk X (fitur): </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bentuk y (target): </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tugas:</span>
<span class="c1"># 1. Memisahkan X (fitur) dan y (target).</span>
<span class="c1"># 2. Melakukan normalisasi Min-Max pada X.</span>
<span class="c1"># 3. Membagi data menjadi data &#39;train&#39; (latih) dan &#39;test&#39; (uji).</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memulai Tahap 4: Persiapan Model...&quot;</span><span class="p">)</span>

<span class="c1"># 1. PISAHKAN FITUR (X) DAN TARGET (y)</span>
<span class="c1"># Pastikan &#39;df_supervised&#39; ada dari Tahap 3</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">fitur_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;lag_1_hari&#39;</span><span class="p">,</span> <span class="s1">&#39;lag_2_hari&#39;</span><span class="p">,</span> <span class="s1">&#39;lag_3_hari&#39;</span><span class="p">]</span>
    <span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;rata_rata_no2&#39;</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">fitur_cols</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bentuk X (fitur): </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bentuk y (target): </span><span class="si">{</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Variabel &#39;df_supervised&#39; tidak ditemukan!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pastikan Anda sudah menjalankan cell Tahap 3.&quot;</span><span class="p">)</span>
    <span class="c1"># Hentikan jika error</span>

<span class="c1"># 2. NORMALISASI FITUR (X)</span>
<span class="c1"># Kita HANYA menormalkan X. JANGAN menormalkan y.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Melakukan Normalisasi Min-Max pada X...&quot;</span><span class="p">)</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span> <span class="c1"># 1. Buat alat scaler-nya</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="c1"># 2. Terapkan ke data X</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data X (fitur) berhasil di-normalisasi (skala 0-1).&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pratinjau X_scaled (5 baris pertama):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>


<span class="c1"># 3. BAGI DATA (TRAIN-TEST SPLIT)</span>
<span class="c1"># Kita pakai 80% data untuk latihan, 20% untuk tes</span>
<span class="n">test_size_percentage</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="c1"># PENTING: Untuk time series, &#39;shuffle&#39; HARUS &#39;False&#39;</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X_scaled</span><span class="p">,</span> 
    <span class="n">y</span><span class="p">,</span> 
    <span class="n">test_size</span><span class="o">=</span><span class="n">test_size_percentage</span><span class="p">,</span> 
    <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span>  <span class="c1"># &lt;-- INI KUNCINYA!</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Data berhasil dibagi (tanpa diacak):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - X_train (latihan fitur): </span><span class="si">{</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - y_train (latihan target): </span><span class="si">{</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - X_test (tes fitur):     </span><span class="si">{</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - y_test (tes target):     </span><span class="si">{</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Tahap 4 Selesai. Data Anda (X_train, y_train, X_test, y_test)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sekarang siap untuk dimasukkan ke model KNN.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Memulai Tahap 4: Persiapan Model...
Bentuk X (fitur): (1092, 3)
Bentuk y (target): (1092,)

Melakukan Normalisasi Min-Max pada X...
Data X (fitur) berhasil di-normalisasi (skala 0-1).
Pratinjau X_scaled (5 baris pertama):
[[0.48200923 0.48200923 0.48200923]
 [0.48200923 0.48200923 0.48200923]
 [0.48200923 0.48200923 0.48200923]
 [0.46321987 0.48200923 0.48200923]
 [0.4444305  0.46321987 0.48200923]]

Data berhasil dibagi (tanpa diacak):
  - X_train (latihan fitur): (873, 3)
  - y_train (latihan target): (873,)
  - X_test (tes fitur):     (219, 3)
  - y_test (tes target):     (219,)

Tahap 4 Selesai. Data Anda (X_train, y_train, X_test, y_test)
sekarang siap untuk dimasukkan ke model KNN.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="tahap-5-pemodelan-knn-regression-evaluasi">
<h2>🤖 Tahap 5 – Pemodelan (KNN Regression) &amp; Evaluasi<a class="headerlink" href="#tahap-5-pemodelan-knn-regression-evaluasi" title="Link to this heading">#</a></h2>
<p>Tahap ini adalah inti dari proses <strong>machine learning</strong>:<br />
kita akan melatih model untuk <strong>memprediksi kadar NO₂</strong> berdasarkan data hari-hari sebelumnya.</p>
<hr class="docutils" />
<section id="tujuan-tahap-5">
<h3>🎯 Tujuan Tahap 5<a class="headerlink" href="#tujuan-tahap-5" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Membuat dan melatih <strong>model KNN Regression</strong>.</p></li>
<li><p>Melakukan <strong>prediksi</strong> menggunakan data uji (<code class="docutils literal notranslate"><span class="pre">X_test</span></code>).</p></li>
<li><p>Mengukur performa model dengan <strong>Mean Absolute Error (MAE)</strong>.</p></li>
<li><p><strong>Memvisualisasikan hasil prediksi vs data aktual</strong> untuk melihat akurasi tren.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="sekilas-tentang-knn-regression">
<h3>💡 Sekilas Tentang KNN Regression<a class="headerlink" href="#sekilas-tentang-knn-regression" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>K-Nearest Neighbors (KNN)</strong> adalah algoritma sederhana tapi efektif.</p></li>
<li><p>Ia <strong>tidak benar-benar “belajar”</strong> seperti neural network; melainkan mencari data latih yang paling mirip dengan input baru.</p></li>
<li><p>Untuk setiap data baru, model mengambil <strong>K tetangga terdekat</strong> dan menghitung <strong>rata-ratanya</strong> sebagai hasil prediksi.</p></li>
<li><p>Semakin kecil nilai K → model lebih sensitif terhadap noise.</p></li>
<li><p>Semakin besar nilai K → model lebih halus tapi bisa kehilangan detail tren.</p></li>
</ul>
</section>
<hr class="docutils" />
<section id="membuat-dan-melatih-model-knn">
<h3>💻 1. Membuat dan Melatih Model KNN<a class="headerlink" href="#membuat-dan-melatih-model-knn" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memulai Tahap 5: Pemodelan dan Evaluasi...&quot;</span><span class="p">)</span>

<span class="c1"># Buat model KNN Regression dengan K=5</span>
<span class="n">k_value</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k_value</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Membuat model KNeighborsRegressor dengan K=</span><span class="si">{</span><span class="n">k_value</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

<span class="c1"># Latih model menggunakan data training</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Melatih model (model.fit)...&quot;</span><span class="p">)</span>
<span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model berhasil dilatih.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Tugas:</span>
<span class="c1"># 1. Membuat dan melatih model KNN Regression.</span>
<span class="c1"># 2. Melakukan prediksi pada data tes.</span>
<span class="c1"># 3. Mengevaluasi model dengan Mean Absolute Error (MAE).</span>
<span class="c1"># 4. Memvisualisasikan hasil prediksi vs data asli.</span>
<span class="c1">#</span>

<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Memulai Tahap 5: Pemodelan dan Evaluasi...&quot;</span><span class="p">)</span>

<span class="c1"># 1. BUAT &amp; LATIH MODEL</span>
<span class="c1"># Sesuai rencana, kita pakai KNN.</span>
<span class="c1"># Kita coba &#39;n_neighbors=5&#39; (K=5) sebagai permulaan.</span>
<span class="n">k_value</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k_value</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Membuat model KNeighborsRegressor dengan K=</span><span class="si">{</span><span class="n">k_value</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

<span class="c1"># Latih model dengan data training</span>
<span class="c1"># Ini adalah proses &quot;belajar&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Melatih model (model.fit)...&quot;</span><span class="p">)</span>
<span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model berhasil dilatih.&quot;</span><span class="p">)</span>

<span class="c1"># 2. LAKUKAN PREDIKSI</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Melakukan prediksi pada data tes (X_test)...&quot;</span><span class="p">)</span>
<span class="c1"># Model akan menebak &#39;y&#39; berdasarkan &#39;X_test&#39;</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediksi selesai.&quot;</span><span class="p">)</span>

<span class="c1"># 3. EVALUASI MODEL (MAE)</span>
<span class="c1"># Kita bandingkan tebakan (y_pred) dengan jawaban asli (y_test)</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- HASIL EVALUASI MODEL ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean Absolute Error (MAE): </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Artinya: Rata-rata, prediksi model kita meleset sekitar </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2"> unit dari nilai NO2 sebenarnya.&quot;</span><span class="p">)</span>

<span class="c1"># 4. VISUALISASI HASIL (Eksplorasi Tren)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Membuat plot perbandingan data asli vs. prediksi...&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="c1"># Kita ambil index (tanggal) dari y_test untuk sumbu X</span>
<span class="n">test_dates</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Plot data asli (y_test)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_dates</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Data Asli (y_test)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="c1"># Plot data prediksi (y_pred)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_dates</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Prediksi Model KNN (y_pred)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Perbandingan Prediksi NO2 vs Data Asli (K=</span><span class="si">{</span><span class="n">k_value</span><span class="si">}</span><span class="s1">, MAE=</span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Tanggal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Rata-rata NO2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- PROYEK SELESAI ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Anda telah berhasil membuat model peramalan NO2!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Coba lihat plot di atas. Apakah garis merah (prediksi)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;mengikuti pola garis biru (asli)?&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Memulai Tahap 5: Pemodelan dan Evaluasi...
Membuat model KNeighborsRegressor dengan K=5...
Melatih model (model.fit)...
Model berhasil dilatih.

Melakukan prediksi pada data tes (X_test)...
Prediksi selesai.

--- HASIL EVALUASI MODEL ---
Mean Absolute Error (MAE): 0.0000
Artinya: Rata-rata, prediksi model kita meleset sekitar 0.0000 unit dari nilai NO2 sebenarnya.

Membuat plot perbandingan data asli vs. prediksi...
</pre></div>
</div>
<img alt="_images/d88f09de56a7be4ee3694c655c5831adb82af3ddbb24b4bedf00f0317d7b4393.png" src="_images/d88f09de56a7be4ee3694c655c5831adb82af3ddbb24b4bedf00f0317d7b4393.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--- PROYEK SELESAI ---
Anda telah berhasil membuat model peramalan NO2!
Coba lihat plot di atas. Apakah garis merah (prediksi)
mengikuti pola garis biru (asli)?
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="langkah-5-lanjutan-menentukan-ambang-batas-threshold">
<h2>⚖️ Langkah 5 (Lanjutan) – Menentukan Ambang Batas (Threshold)<a class="headerlink" href="#langkah-5-lanjutan-menentukan-ambang-batas-threshold" title="Link to this heading">#</a></h2>
<p>Setelah model KNN selesai dibuat dan dievaluasi, langkah tambahan ini berguna untuk <strong>menentukan batas kadar NO₂ yang dianggap “tidak aman”</strong>.</p>
<p>Langkah ini tidak wajib untuk pelatihan model, tapi <strong>sangat penting untuk analisis kualitas udara</strong>.</p>
<hr class="docutils" />
<section id="tujuan">
<h3>🎯 Tujuan<a class="headerlink" href="#tujuan" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Menganalisis <strong>sebaran data NO₂</strong> dari dataset latih (<code class="docutils literal notranslate"><span class="pre">y_train</span></code>).</p></li>
<li><p>Menentukan <strong>ambang batas (threshold)</strong> untuk klasifikasi sederhana:</p>
<ul class="simple">
<li><p>Di bawah ambang → <strong>Aman</strong></p></li>
<li><p>Di atas ambang → <strong>Tidak Aman</strong></p></li>
</ul>
</li>
</ol>
</section>
<hr class="docutils" />
<section id="kode-program">
<h3>💻 Kode Program<a class="headerlink" href="#kode-program" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- LANGKAH 5 (Lanjutan): MENCARI AMBANG BATAS (THRESHOLD) ---</span>

<span class="c1"># Lihat statistik deskriptif dari data NO2 latih</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menganalisis sebaran data NO2 (y_train):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Gunakan Kuartil 75% (Q3) sebagai ambang batas</span>
<span class="n">ambang_batas_saran</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Saran ambang batas (Kuartil 75%): </span><span class="si">{</span><span class="n">ambang_batas_saran</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Artinya: 25</span><span class="si">% d</span><span class="s2">ari data Anda memiliki nilai NO2 DI ATAS angka ini.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kita cek statistik dari data &#39;y_train&#39; (data target yang sudah bersih)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menganalisis sebaran data NO2 (y_train):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Saran:</span>
<span class="c1"># gunakan &#39;75%&#39; (kuartil 3) sebagai ambang batas</span>
<span class="c1"># Artinya, 25% data teratas dianggap &quot;Tidak Aman&quot;</span>
<span class="n">ambang_batas_saran</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Saran ambang batas (Kuartil 75%): </span><span class="si">{</span><span class="n">ambang_batas_saran</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Artinya: 25</span><span class="si">% d</span><span class="s2">ari data Anda memiliki nilai NO2 DI ATAS angka ini.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Menganalisis sebaran data NO2 (y_train):
count    873.000000
mean       0.000024
std        0.000009
min       -0.000017
25%        0.000017
50%        0.000024
75%        0.000029
max        0.000059
Name: rata_rata_no2, dtype: float64

Saran ambang batas (Kuartil 75%): 0.000029
Artinya: 25% dari data Anda memiliki nilai NO2 DI ATAS angka ini.
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="langkah-5-lanjutan-2-menentukan-ambang-batas-baru-median-50">
<h2>⚖️ Langkah 5 (Lanjutan 2) – Menentukan Ambang Batas Baru (Median / 50%)<a class="headerlink" href="#langkah-5-lanjutan-2-menentukan-ambang-batas-baru-median-50" title="Link to this heading">#</a></h2>
<p>Pada langkah sebelumnya, kita menggunakan <strong>kuartil ke-3 (75%)</strong> sebagai ambang batas untuk menandai kondisi <strong>“tidak aman”</strong> (polusi tinggi).<br />
Sekarang, kita akan mencoba pendekatan lain: menggunakan <strong>median (50%)</strong> atau <strong>nilai tengah distribusi data</strong>.</p>
<hr class="docutils" />
<section id="id5">
<h3>🎯 Tujuan<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Melihat kembali <strong>sebaran data NO₂</strong> dari data latih (<code class="docutils literal notranslate"><span class="pre">y_train</span></code>).</p></li>
<li><p>Menentukan ambang batas alternatif berdasarkan <strong>median (50%)</strong>.</p></li>
<li><p>Membandingkan ambang batas median dengan ambang batas kuartil ke-3 sebelumnya.</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="id6">
<h3>💻 Kode Program<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- MENDAPATKAN AMBANG BATAS BARU (MEDIAN / 50%) ---</span>

<span class="c1"># Analisis sebaran data NO2</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menganalisis sebaran data NO2 (y_train):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Ambil nilai median (50%)</span>
<span class="n">ambang_batas_median</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.50</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ambang Batas BARU (Median 50%): </span><span class="si">{</span><span class="n">ambang_batas_median</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- MENDAPATKAN AMBANG BATAS BARU (MEDIAN/50%) ---</span>

<span class="c1"># Kita cek statistik lagi, tapi kali ini kita ambil &#39;50%&#39; (median)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Menganalisis sebaran data NO2 (y_train):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="n">ambang_batas_median</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ambang Batas BARU (Median 50%): </span><span class="si">{</span><span class="n">ambang_batas_median</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Menganalisis sebaran data NO2 (y_train):
count    873.000000
mean       0.000024
std        0.000009
min       -0.000017
25%        0.000017
50%        0.000024
75%        0.000029
max        0.000059
Name: rata_rata_no2, dtype: float64

Ambang Batas BARU (Median 50%): 0.000024
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="langkah-6-evaluasi-model-dalam-bentuk-klasifikasi-aman-vs-tidak-aman">
<h2>🧭 Langkah 6 – Evaluasi Model dalam Bentuk Klasifikasi (Aman vs Tidak Aman)<a class="headerlink" href="#langkah-6-evaluasi-model-dalam-bentuk-klasifikasi-aman-vs-tidak-aman" title="Link to this heading">#</a></h2>
<p>Setelah model KNN berhasil memprediksi kadar <strong>NO₂</strong> secara numerik,<br />
sekarang kita akan mengubah hasilnya menjadi <strong>kategori</strong>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Aman&quot;</span></code> jika kadar NO₂ ≤ ambang batas.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&quot;Tidak</span> <span class="pre">Aman&quot;</span></code> jika kadar NO₂ &gt; ambang batas.</p></li>
</ul>
<p>Langkah ini penting agar hasil model bisa lebih mudah <strong>ditafsirkan secara praktis</strong>,<br />
misalnya untuk sistem peringatan dini kualitas udara.</p>
<hr class="docutils" />
<section id="id7">
<h3>🎯 Tujuan<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Mengonversi hasil regresi menjadi kategori <em>Aman / Tidak Aman</em>.</p></li>
<li><p>Mengukur <strong>akurasi model</strong> dalam bentuk klasifikasi.</p></li>
<li><p>Menampilkan <strong>laporan kinerja (classification report)</strong> dan <strong>confusion matrix</strong>.</p></li>
</ol>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">classification_report</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># !!! PENTING: GANTI ANGKA INI !!!</span>
<span class="c1"># Ganti dengan angka &#39;Median 50%&#39; dari output cell sebelumnya</span>
<span class="n">ambang_batas_anda</span> <span class="o">=</span> <span class="mf">0.000024</span>  <span class="c1"># &lt;--- GANTI ANGKA INI DENGAN NILAI MEDIAN ANDA</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Menggunakan ambang batas &#39;Tidak Aman&#39; jika NO2 &gt; </span><span class="si">{</span><span class="n">ambang_batas_anda</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 1. Ubah y_test (data asli) menjadi kategori</span>
<span class="n">asli_kategori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="n">ambang_batas_anda</span><span class="p">,</span> <span class="s2">&quot;Tidak Aman&quot;</span><span class="p">,</span> <span class="s2">&quot;Aman&quot;</span><span class="p">)</span>

<span class="c1"># 2. Ubah y_pred (hasil tebakan) menjadi kategori</span>
<span class="n">prediksi_kategori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">&gt;</span> <span class="n">ambang_batas_anda</span><span class="p">,</span> <span class="s2">&quot;Tidak Aman&quot;</span><span class="p">,</span> <span class="s2">&quot;Aman&quot;</span><span class="p">)</span>

<span class="c1"># 3. Hitung Akurasi</span>
<span class="n">akurasi</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">asli_kategori</span><span class="p">,</span> <span class="n">prediksi_kategori</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">AKURASI MODEL (Klasifikasi): </span><span class="si">{</span><span class="n">akurasi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># 4. Tampilkan Laporan Rinci</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Laporan Klasifikasi:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">classification_report</span><span class="p">(</span><span class="n">asli_kategori</span><span class="p">,</span> <span class="n">prediksi_kategori</span><span class="p">,</span> <span class="n">zero_division</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># 5. Tampilkan Confusion Matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix:&quot;</span><span class="p">)</span>
<span class="n">ConfusionMatrixDisplay</span><span class="o">.</span><span class="n">from_predictions</span><span class="p">(</span><span class="n">asli_kategori</span><span class="p">,</span> <span class="n">prediksi_kategori</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Blues&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Aman&quot;</span><span class="p">,</span> <span class="s2">&quot;Tidak Aman&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Menggunakan ambang batas &#39;Tidak Aman&#39; jika NO2 &gt; 2.4e-05

AKURASI MODEL (Klasifikasi): 80.82%
Laporan Klasifikasi:
              precision    recall  f1-score   support

        Aman       0.36      0.53      0.43        30
  Tidak Aman       0.92      0.85      0.88       189

    accuracy                           0.81       219
   macro avg       0.64      0.69      0.66       219
weighted avg       0.84      0.81      0.82       219

Confusion Matrix:
</pre></div>
</div>
<img alt="_images/ff4fbe520f8349cfeee4f04c8874dee955dbcd88b00eedd44791875830d899ad.png" src="_images/ff4fbe520f8349cfeee4f04c8874dee955dbcd88b00eedd44791875830d899ad.png" />
</div>
</div>
</section>
</section>
<section id="langkah-7-membuat-prediksi-2-hari-ke-depan">
<h2>🔮 Langkah 7 – Membuat Prediksi 2 Hari ke Depan<a class="headerlink" href="#langkah-7-membuat-prediksi-2-hari-ke-depan" title="Link to this heading">#</a></h2>
<p>Setelah model KNN dilatih dan ambang batas ditentukan,<br />
kita akan membuat fungsi untuk <strong>memprediksi kadar NO₂ dua hari ke depan</strong><br />
berdasarkan <strong>tiga hari terakhir</strong> dari data aktual.</p>
<hr class="docutils" />
<section id="id8">
<h3>🎯 Tujuan<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Membuat fungsi prediksi otomatis <code class="docutils literal notranslate"><span class="pre">prediksi_dua_hari_ke_depan()</span></code>.</p></li>
<li><p>Melakukan <strong>prediksi berantai</strong>:</p>
<ul class="simple">
<li><p>Hari ke-1 (besok) → digunakan untuk</p></li>
<li><p>Hari ke-2 (lusa).</p></li>
</ul>
</li>
<li><p>Mengklasifikasikan hasil menjadi <code class="docutils literal notranslate"><span class="pre">&quot;Aman&quot;</span></code> atau <code class="docutils literal notranslate"><span class="pre">&quot;Tidak</span> <span class="pre">Aman&quot;</span></code><br />
berdasarkan ambang batas (<code class="docutils literal notranslate"><span class="pre">ambang_batas_anda</span></code>).</p></li>
</ol>
</section>
<hr class="docutils" />
<section id="id9">
<h3>💻 Kode Program<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># --- LANGKAH 7: MEMBUAT PREDIKSI 2 HARI KE DEPAN ---</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Membuat fungsi prediksi 2 hari ke depan...&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prediksi_dua_hari_ke_depan</span><span class="p">(</span><span class="n">data_3_hari_terakhir</span><span class="p">,</span> <span class="n">scaler_model</span><span class="p">,</span> <span class="n">knn_model</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fungsi untuk memprediksi kadar NO2 dua hari ke depan secara berantai.</span>
<span class="sd">    </span>
<span class="sd">    Parameter:</span>
<span class="sd">      - data_3_hari_terakhir : array (1D) berisi 3 nilai NO2 terakhir</span>
<span class="sd">      - scaler_model         : objek MinMaxScaler (dari Tahap 4)</span>
<span class="sd">      - knn_model            : model KNN (dari Tahap 5)</span>
<span class="sd">      - threshold            : ambang batas (dari Langkah 6)</span>
<span class="sd">      </span>
<span class="sd">    Output:</span>
<span class="sd">      Dictionary berisi prediksi besok &amp; lusa (nilai + kategori)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Salin input agar data aslinya tidak berubah</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_3_hari_terakhir</span><span class="p">)</span>
    
    <span class="c1"># --- 1️⃣ PREDIKSI HARI KE-1 (BESOK) ---</span>
    <span class="n">input_hari_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">input_hari_1_scaled</span> <span class="o">=</span> <span class="n">scaler_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_hari_1</span><span class="p">)</span>
    <span class="n">prediksi_hari_1</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_hari_1_scaled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">kategori_hari_1</span> <span class="o">=</span> <span class="s2">&quot;Tidak Aman&quot;</span> <span class="k">if</span> <span class="n">prediksi_hari_1</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="s2">&quot;Aman&quot;</span>
    
    <span class="c1"># --- 2️⃣ PREDIKSI HARI KE-2 (LUSA) ---</span>
    <span class="c1"># Geser data dan tambahkan hasil prediksi hari ke-1</span>
    <span class="n">input_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">input_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediksi_hari_1</span><span class="p">)</span>
    <span class="n">input_hari_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">input_hari_2_scaled</span> <span class="o">=</span> <span class="n">scaler_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_hari_2</span><span class="p">)</span>
    <span class="n">prediksi_hari_2</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_hari_2_scaled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">kategori_hari_2</span> <span class="o">=</span> <span class="s2">&quot;Tidak Aman&quot;</span> <span class="k">if</span> <span class="n">prediksi_hari_2</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="s2">&quot;Aman&quot;</span>
    
    <span class="c1"># Kembalikan hasil prediksi</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;prediksi_besok&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;nilai_no2&quot;</span><span class="p">:</span> <span class="n">prediksi_hari_1</span><span class="p">,</span>
            <span class="s2">&quot;kategori&quot;</span><span class="p">:</span> <span class="n">kategori_hari_1</span>
        <span class="p">},</span>
        <span class="s2">&quot;prediksi_lusa&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;nilai_no2&quot;</span><span class="p">:</span> <span class="n">prediksi_hari_2</span><span class="p">,</span>
            <span class="s2">&quot;kategori&quot;</span><span class="p">:</span> <span class="n">kategori_hari_2</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="c1"># --- UJI COBA FUNGSINYA ---</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Ambil 3 data NO2 terakhir dari data latih</span>
    <span class="n">data_terakhir</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">n_lags</span><span class="p">:]</span>   <span class="c1"># n_lags = 3 (dari Tahap 3)</span>
    <span class="n">data_terakhir_array</span> <span class="o">=</span> <span class="n">data_terakhir</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Menggunakan 3 data NO2 terakhir sebagai input:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data_terakhir_array</span><span class="p">)</span>
    
    <span class="c1"># Jalankan fungsi prediksi</span>
    <span class="n">hasil_ramalan</span> <span class="o">=</span> <span class="n">prediksi_dua_hari_ke_depan</span><span class="p">(</span>
        <span class="n">data_terakhir_array</span><span class="p">,</span> 
        <span class="n">scaler</span><span class="p">,</span> 
        <span class="n">knn_model</span><span class="p">,</span> 
        <span class="n">ambang_batas_anda</span>
    <span class="p">)</span>
    
    <span class="c1"># Tampilkan hasilnya</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- HASIL RAMALAN 2 HARI KE DEPAN ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ramalan BESOK (Hari +1):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Nilai NO2 : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_besok&#39;</span><span class="p">][</span><span class="s1">&#39;nilai_no2&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Kategori  : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_besok&#39;</span><span class="p">][</span><span class="s1">&#39;kategori&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ramalan LUSA (Hari +2):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Nilai NO2 : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_lusa&#39;</span><span class="p">][</span><span class="s1">&#39;nilai_no2&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Kategori  : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_lusa&#39;</span><span class="p">][</span><span class="s1">&#39;kategori&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Pastikan variabel &#39;y_train&#39;, &#39;n_lags&#39;, &#39;scaler&#39;, dan &#39;knn_model&#39; sudah didefinisikan.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Terjadi error saat prediksi: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kita butuh:</span>
<span class="c1"># - &#39;scaler&#39; (dari Tahap 4) untuk normalisasi input</span>
<span class="c1"># - &#39;knn_model&#39; (dari Tahap 5) untuk memprediksi</span>
<span class="c1"># - &#39;ambang_batas_anda&#39; (dari Langkah 6) untuk interpretasi</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Membuat fungsi prediksi 2 hari ke depan...&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">prediksi_dua_hari_ke_depan</span><span class="p">(</span><span class="n">data_3_hari_terakhir</span><span class="p">,</span> <span class="n">scaler_model</span><span class="p">,</span> <span class="n">knn_model</span><span class="p">,</span> <span class="n">threshold</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fungsi untuk prediksi 2 hari ke depan secara berantai.</span>
<span class="sd">    Input: data_3_hari_terakhir (numpy array 1D berisi 3 nilai NO2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Salin data input agar tidak berubah</span>
    <span class="n">input_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_3_hari_terakhir</span><span class="p">)</span>
    
    <span class="c1"># --- 1. PREDIKSI HARI KE-1 (BESOK) ---</span>
    
    <span class="c1"># Ubah input jadi 2D array [[]]</span>
    <span class="n">input_hari_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Normalisasi input</span>
    <span class="n">input_hari_1_scaled</span> <span class="o">=</span> <span class="n">scaler_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_hari_1</span><span class="p">)</span>
    
    <span class="c1"># Prediksi</span>
    <span class="n">prediksi_hari_1</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_hari_1_scaled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Interpretasi</span>
    <span class="n">kategori_hari_1</span> <span class="o">=</span> <span class="s2">&quot;Tidak Aman&quot;</span> <span class="k">if</span> <span class="n">prediksi_hari_1</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="s2">&quot;Aman&quot;</span>
    
    
    <span class="c1"># --- 2. PREDIKSI HARI KE-2 (LUSA) ---</span>
    
    <span class="c1"># Siapkan input baru: geser data dan masukkan prediksi hari 1</span>
    <span class="c1"># Input lama: [hari -3, hari -2, hari -1]</span>
    <span class="c1"># Input baru: [hari -2, hari -1, prediksi_hari_1]</span>
    <span class="n">input_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Hapus data &#39;hari -3&#39;</span>
    <span class="n">input_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediksi_hari_1</span><span class="p">)</span> <span class="c1"># Tambah data &#39;prediksi_hari_1&#39;</span>
    
    <span class="c1"># Ubah jadi 2D array [[]]</span>
    <span class="n">input_hari_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Normalisasi input baru</span>
    <span class="n">input_hari_2_scaled</span> <span class="o">=</span> <span class="n">scaler_model</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">input_hari_2</span><span class="p">)</span>
    
    <span class="c1"># Prediksi</span>
    <span class="n">prediksi_hari_2</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_hari_2_scaled</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># Interpretasi</span>
    <span class="n">kategori_hari_2</span> <span class="o">=</span> <span class="s2">&quot;Tidak Aman&quot;</span> <span class="k">if</span> <span class="n">prediksi_hari_2</span> <span class="o">&gt;</span> <span class="n">threshold</span> <span class="k">else</span> <span class="s2">&quot;Aman&quot;</span>
    
    <span class="c1"># Kembalikan hasilnya</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;prediksi_besok&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;nilai_no2&quot;</span><span class="p">:</span> <span class="n">prediksi_hari_1</span><span class="p">,</span>
            <span class="s2">&quot;kategori&quot;</span><span class="p">:</span> <span class="n">kategori_hari_1</span>
        <span class="p">},</span>
        <span class="s2">&quot;prediksi_lusa&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;nilai_no2&quot;</span><span class="p">:</span> <span class="n">prediksi_hari_2</span><span class="p">,</span>
            <span class="s2">&quot;kategori&quot;</span><span class="p">:</span> <span class="n">kategori_hari_2</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="c1"># --- MARI KITA COBA FUNGSINYA ---</span>

<span class="c1"># Kita ambil 3 data NO2 NYATA terakhir dari dataset kita</span>
<span class="c1"># (Ini adalah 3 hari terakhir sebelum data &#39;test&#39; dimulai)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">data_terakhir</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">n_lags</span><span class="p">:]</span> <span class="c1"># &#39;n_lags&#39; = 3 (dari Tahap 3)</span>
    <span class="n">data_terakhir_array</span> <span class="o">=</span> <span class="n">data_terakhir</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Menggunakan 3 data NO2 terakhir sebagai input:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">data_terakhir_array</span><span class="p">)</span>

    <span class="c1"># Jalankan fungsi prediksi</span>
    <span class="n">hasil_ramalan</span> <span class="o">=</span> <span class="n">prediksi_dua_hari_ke_depan</span><span class="p">(</span>
        <span class="n">data_terakhir_array</span><span class="p">,</span> 
        <span class="n">scaler</span><span class="p">,</span>  <span class="c1"># Variabel dari Tahap 4</span>
        <span class="n">knn_model</span><span class="p">,</span> <span class="c1"># Variabel dari Tahap 5</span>
        <span class="n">ambang_batas_anda</span> <span class="c1"># Variabel dari Langkah 6</span>
    <span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- HASIL RAMALAN 2 HARI KE DEPAN ---&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ramalan BESOK (Hari +1):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Nilai NO2 : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_besok&#39;</span><span class="p">][</span><span class="s1">&#39;nilai_no2&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Kategori  : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_besok&#39;</span><span class="p">][</span><span class="s1">&#39;kategori&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Ramalan LUSA (Hari +2):&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Nilai NO2 : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_lusa&#39;</span><span class="p">][</span><span class="s1">&#39;nilai_no2&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - Kategori  : </span><span class="si">{</span><span class="n">hasil_ramalan</span><span class="p">[</span><span class="s1">&#39;prediksi_lusa&#39;</span><span class="p">][</span><span class="s1">&#39;kategori&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">ERROR: Pastikan variabel &#39;y_train&#39;, &#39;n_lags&#39;, &#39;scaler&#39;, &#39;knn_model&#39; sudah ada.&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Terjadi error saat prediksi: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Membuat fungsi prediksi 2 hari ke depan...

Menggunakan 3 data NO2 terakhir sebagai input:
[2.59051906e-05 2.64387979e-05 2.61467015e-05]

--- HASIL RAMALAN 2 HARI KE DEPAN ---
Ramalan BESOK (Hari +1):
  - Nilai NO2 : 0.000025
  - Kategori  : Tidak Aman

Ramalan LUSA (Hari +2):
  - Nilai NO2 : 0.000026
  - Kategori  : Tidak Aman
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/conda/envs/openeo/lib/python3.11/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but MinMaxScaler was fitted with feature names
  warnings.warn(
/opt/conda/envs/openeo/lib/python3.11/site-packages/sklearn/utils/validation.py:2749: UserWarning: X does not have valid feature names, but MinMaxScaler was fitted with feature names
  warnings.warn(
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="langkah-eksperimen-mencari-jumlah-lag-fitur-terbaik">
<h2>🧪 Langkah Eksperimen – Mencari Jumlah Lag (Fitur) Terbaik<a class="headerlink" href="#langkah-eksperimen-mencari-jumlah-lag-fitur-terbaik" title="Link to this heading">#</a></h2>
<p>Pada tahap ini, kita akan melakukan <strong>eksperimen otomatis</strong><br />
untuk mencari jumlah <em>lag</em> terbaik (berapa banyak hari sebelumnya yang digunakan sebagai fitur input).</p>
<p>Langkah ini membantu Anda <strong>menentukan konfigurasi optimal</strong> untuk model KNN.</p>
<hr class="docutils" />
<section id="id10">
<h3>🎯 Tujuan<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Menguji beberapa nilai <code class="docutils literal notranslate"><span class="pre">lag</span></code> (misalnya 2, 3, 5, 7, 10, 14 hari).</p></li>
<li><p>Menghitung akurasi klasifikasi untuk masing-masing jumlah <code class="docutils literal notranslate"><span class="pre">lag</span></code>.</p></li>
<li><p>Menentukan <code class="docutils literal notranslate"><span class="pre">lag</span></code> terbaik berdasarkan hasil akurasi tertinggi.</p></li>
</ol>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span>

<span class="c1"># --- 1. MEMBUAT FUNGSI EKSPERIMEN ---</span>
<span class="c1"># Fungsi ini &quot;membungkus&quot; Tahap 3, 4, 5, dan 6</span>

<span class="k">def</span> <span class="nf">jalankan_eksperimen_lag</span><span class="p">(</span><span class="n">n_lags_coba</span><span class="p">,</span> <span class="n">data_bersih_df</span><span class="p">,</span> <span class="n">k_value</span><span class="p">,</span> <span class="n">ambang_batas</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fungsi ini menjalankan ulang pipeline untuk n_lags tertentu</span>
<span class="sd">    dan mengembalikan nilai akurasi klasifikasinya.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># --- (Salinan dari Tahap 3: Feature Engineering) ---</span>
        <span class="n">df_supervised</span> <span class="o">=</span> <span class="n">data_bersih_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">nama_target</span> <span class="o">=</span> <span class="s1">&#39;rata_rata_no2&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_lags_coba</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">df_supervised</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;lag_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_hari&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">nama_target</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        
        <span class="n">df_supervised</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
        
        <span class="c1"># --- (Salinan dari Tahap 4: Persiapan Model) ---</span>
        <span class="n">fitur_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;lag_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_hari&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_lags_coba</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;rata_rata_no2&#39;</span>
        
        <span class="n">X</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">fitur_cols</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df_supervised</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span>
        
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span>
        <span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        
        <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
            <span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        
        <span class="c1"># --- (Salinan dari Tahap 5: Pemodelan) ---</span>
        <span class="n">knn_model</span> <span class="o">=</span> <span class="n">KNeighborsRegressor</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="n">k_value</span><span class="p">)</span>
        <span class="n">knn_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">knn_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        
        <span class="c1"># --- (Salinan dari Tahap 6: Evaluasi Klasifikasi) ---</span>
        <span class="n">asli_kategori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_test</span> <span class="o">&gt;</span> <span class="n">ambang_batas</span><span class="p">,</span> <span class="s2">&quot;Tidak Aman&quot;</span><span class="p">,</span> <span class="s2">&quot;Aman&quot;</span><span class="p">)</span>
        <span class="n">prediksi_kategori</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">&gt;</span> <span class="n">ambang_batas</span><span class="p">,</span> <span class="s2">&quot;Tidak Aman&quot;</span><span class="p">,</span> <span class="s2">&quot;Aman&quot;</span><span class="p">)</span>
        
        <span class="n">akurasi</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">asli_kategori</span><span class="p">,</span> <span class="n">prediksi_kategori</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">akurasi</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  ERROR saat menjalankan lag </span><span class="si">{</span><span class="n">n_lags_coba</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.0</span>

<span class="c1"># --- 2. PERSIAPAN LOOP EKSPERIMEN ---</span>

<span class="c1"># AMBIL VARIABEL DARI KODE ANDA SEBELUMNYA</span>
<span class="c1"># Pastikan variabel &#39;df&#39; adalah data bersih dari TAHAP 2</span>
<span class="c1"># Pastikan &#39;k_value&#39; adalah K yang Anda pakai (misal: 5)</span>
<span class="c1"># Pastikan &#39;ambang_batas_median&#39; adalah nilai median dari Langkah 6 (Perbaikan)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">data_bersih_tahap2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> 
    <span class="n">k_knn</span> <span class="o">=</span> <span class="n">k_value</span> <span class="c1"># Menggunakan &#39;k_value&#39; (misal 5) dari Tahap 5</span>
    
    <span class="c1"># !!! PENTING: GANTI ANGKA INI !!!</span>
    <span class="c1"># Ganti dengan angka &#39;Median 50%&#39; dari &#39;Langkah 6 (Perbaikan)&#39;</span>
    <span class="n">ambang_batas_median</span> <span class="o">=</span> <span class="mf">0.000150</span>  <span class="c1"># &lt;--- GANTI ANGKA INI DENGAN NILAI MEDIAN ANDA</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Variabel berhasil dimuat. Siap memulai eksperimen.&quot;</span><span class="p">)</span>
    
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Pastikan var &#39;df&#39;, &#39;k_value&#39;, atau &#39;ambang_batas_median&#39; ada&quot;</span><span class="p">)</span>

<span class="c1"># --- 3. JALANKAN LOOP EKSPERIMEN ---</span>

<span class="c1"># Ini adalah daftar jumlah lag yang ingin kita coba</span>
<span class="n">daftar_lags_dicoba</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span> 
<span class="n">hasil_eksperimen</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Memulai eksperimen untuk K=</span><span class="si">{</span><span class="n">k_knn</span><span class="si">}</span><span class="s2"> dan Threshold=</span><span class="si">{</span><span class="n">ambang_batas_median</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">daftar_lags_dicoba</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--- Menjalankan eksperimen untuk </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s2"> lag... ---&quot;</span><span class="p">)</span>
    
    <span class="c1"># Panggil fungsi yang kita buat</span>
    <span class="n">akurasi_hasil</span> <span class="o">=</span> <span class="n">jalankan_eksperimen_lag</span><span class="p">(</span>
        <span class="n">n_lags_coba</span><span class="o">=</span><span class="n">lag</span><span class="p">,</span>
        <span class="n">data_bersih_df</span><span class="o">=</span><span class="n">data_bersih_tahap2</span><span class="p">,</span>
        <span class="n">k_value</span><span class="o">=</span><span class="n">k_knn</span><span class="p">,</span>
        <span class="n">ambang_batas</span><span class="o">=</span><span class="n">ambang_batas_median</span>
    <span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Akurasi untuk </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s2"> lag: </span><span class="si">{</span><span class="n">akurasi_hasil</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="n">hasil_eksperimen</span><span class="p">[</span><span class="n">lag</span><span class="p">]</span> <span class="o">=</span> <span class="n">akurasi_hasil</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">--- HASIL AKHIR EKSPERIMEN ---&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Jumlah Lag -&gt; Akurasi:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">lag</span><span class="p">,</span> <span class="n">akurasi</span> <span class="ow">in</span> <span class="n">hasil_eksperimen</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s2"> lag   -&gt; </span><span class="si">{</span><span class="n">akurasi</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Temukan yang terbaik</span>
<span class="n">best_lag</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">hasil_eksperimen</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">hasil_eksperimen</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
<span class="n">best_accuracy</span> <span class="o">=</span> <span class="n">hasil_eksperimen</span><span class="p">[</span><span class="n">best_lag</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Eksperimen Selesai.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;HASIL TERBAIK: Menggunakan </span><span class="si">{</span><span class="n">best_lag</span><span class="si">}</span><span class="s2"> lag, mendapatkan akurasi </span><span class="si">{</span><span class="n">best_accuracy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Variabel berhasil dimuat. Siap memulai eksperimen.

Memulai eksperimen untuk K=5 dan Threshold=0.000150
--- Menjalankan eksperimen untuk 2 lag... ---
  Akurasi untuk 2 lag: 100.00%
--- Menjalankan eksperimen untuk 3 lag... ---
  Akurasi untuk 3 lag: 100.00%
--- Menjalankan eksperimen untuk 5 lag... ---
  Akurasi untuk 5 lag: 100.00%
--- Menjalankan eksperimen untuk 7 lag... ---
  Akurasi untuk 7 lag: 100.00%
--- Menjalankan eksperimen untuk 10 lag... ---
  Akurasi untuk 10 lag: 100.00%
--- Menjalankan eksperimen untuk 14 lag... ---
  Akurasi untuk 14 lag: 100.00%

--- HASIL AKHIR EKSPERIMEN ---
Jumlah Lag -&gt; Akurasi:
  2 lag   -&gt; 100.00%
  3 lag   -&gt; 100.00%
  5 lag   -&gt; 100.00%
  7 lag   -&gt; 100.00%
  10 lag   -&gt; 100.00%
  14 lag   -&gt; 100.00%

Eksperimen Selesai.
HASIL TERBAIK: Menggunakan 2 lag, mendapatkan akurasi 100.00%.
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="coba.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">coba</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#penjelasan-kode-mengecek-atribut-metadata-koleksi-sentinel-5p">🛰️ Penjelasan Kode: Mengecek Atribut Metadata Koleksi Sentinel-5P</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan-utama">🔍 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penjelasan-baris-per-baris">💻 Penjelasan Baris per Baris</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#penjelasan-kode-mengambil-daftar-band-dari-metadata-sentinel-5p">🛰️ Penjelasan Kode: Mengambil Daftar Band dari Metadata Sentinel-5P</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">🔍 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">💻 Penjelasan Baris per Baris</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-1-mengambil-data-no2-dari-sentinel-5p-versi-final-yang-sudah-diperbaiki">🛰️ Tahap 1 – Mengambil Data NO₂ dari Sentinel-5P (Versi Final yang Sudah Diperbaiki)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-import-library">💻 1. Setup – Import Library</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-2-pra-pemrosesan-data-preprocessing-no2-sentinel-5p">🧹 Tahap 2 – Pra-Pemrosesan Data (Preprocessing NO₂ Sentinel-5P)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">🎯 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-library">💻 1. Import Library</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-3-feature-engineering-mengubah-data-time-series-menjadi-supervised">⚙️ Tahap 3 – Feature Engineering (Mengubah Data Time Series menjadi Supervised)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">🎯 Tujuan Utama</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#konsep-singkat-lag-feature">💡 Konsep Singkat: “Lag Feature”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#inisialisasi-dan-persiapan">💻 1. Inisialisasi dan Persiapan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tugas">Tugas:</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#membuat-fitur-lag-data-1-2-3-hari-sebelumnya">1. Membuat “fitur lag” (data 1, 2, 3 hari sebelumnya).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mendefinisikan-x-fitur-dan-y-target">2. Mendefinisikan X (fitur) dan y (target).</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#menghapus-baris-nan-yang-muncul-akibat-pergeseran">3. Menghapus baris NaN yang muncul akibat pergeseran.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#penting-pastikan-anda-masih-punya-variabel-df">PENTING: Pastikan Anda masih punya variabel ‘df’</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dari-tahap-2-yang-sudah-bersih">dari Tahap 2 yang sudah bersih.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tentukan-jumlah-lag">1. TENTUKAN JUMLAH LAG</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sesuai-rencana-kita-akan-pakai-3-hari-sebelumnya-3-lags">Sesuai rencana, kita akan pakai 3 hari sebelumnya (3 lags)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#buat-dataframe-baru-untuk-data-supervised">Buat dataframe baru untuk data supervised</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#buat-fitur-lag">2. BUAT FITUR “LAG”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ini-adalah-inti-dari-sliding-window">Ini adalah inti dari “sliding window”</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hapus-baris-kosong-nan">3. HAPUS BARIS KOSONG (NaN)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#baris-baris-pertama-tidak-akan-punya-data-lag-jadi-kita-buang">Baris-baris pertama tidak akan punya data lag, jadi kita buang</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hasil-akhir">4. HASIL AKHIR</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-4-persiapan-model-normalisasi-train-test-split">⚙️ Tahap 4 – Persiapan Model (Normalisasi &amp; Train-Test Split)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan-tahap-4">🎯 Tujuan Tahap 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mengapa-normalisasi-penting">💡 Mengapa Normalisasi Penting?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pisahkan-fitur-dan-target">💻 1. Pisahkan Fitur dan Target</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#tahap-5-pemodelan-knn-regression-evaluasi">🤖 Tahap 5 – Pemodelan (KNN Regression) &amp; Evaluasi</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan-tahap-5">🎯 Tujuan Tahap 5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sekilas-tentang-knn-regression">💡 Sekilas Tentang KNN Regression</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#membuat-dan-melatih-model-knn">💻 1. Membuat dan Melatih Model KNN</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-5-lanjutan-menentukan-ambang-batas-threshold">⚖️ Langkah 5 (Lanjutan) – Menentukan Ambang Batas (Threshold)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tujuan">🎯 Tujuan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#kode-program">💻 Kode Program</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-5-lanjutan-2-menentukan-ambang-batas-baru-median-50">⚖️ Langkah 5 (Lanjutan 2) – Menentukan Ambang Batas Baru (Median / 50%)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">🎯 Tujuan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">💻 Kode Program</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-6-evaluasi-model-dalam-bentuk-klasifikasi-aman-vs-tidak-aman">🧭 Langkah 6 – Evaluasi Model dalam Bentuk Klasifikasi (Aman vs Tidak Aman)</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">🎯 Tujuan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-7-membuat-prediksi-2-hari-ke-depan">🔮 Langkah 7 – Membuat Prediksi 2 Hari ke Depan</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">🎯 Tujuan</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">💻 Kode Program</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#langkah-eksperimen-mencari-jumlah-lag-fitur-terbaik">🧪 Langkah Eksperimen – Mencari Jumlah Lag (Fitur) Terbaik</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">🎯 Tujuan</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dicky Saputra calon data analyst
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>